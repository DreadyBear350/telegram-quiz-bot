import telebot
from telebot.types import Poll
import time
import os

# ==== –í–ê–® –¢–û–ö–ï–ù ====
TOKEN = "8537067418:AAF6FR2KAvaf0oED12JP7zFv4u0Sjsi9CNA"

# ==== –í–û–ü–†–û–°–´ ====
QUESTIONS = [
    {
        "question": "–í–æ–ø—Ä–æ—Å ‚Ññ1\n–í –∫–∞–∫–æ–π –º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω–æ–π —à–∫–æ–ª–µ –ø–æ—è–≤–∏–ª—Å—è –ø–µ—Ä–≤—ã–π –∫–∞–±–∏–Ω–µ—Ç Easy School?",
        "options": ["–°–û–® ‚Ññ24", "–°–û–® ‚Ññ77", "–°–û–® ‚Ññ19"],
        "correct_id": 1,
        "explanation": "–ò–º–µ–Ω–Ω–æ –≤ —à–∫–æ–ª–µ ‚Ññ77 –≤ –ü–µ—Ä–≤–æ–º–∞–π—Å–∫–æ–º –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω–µ –≤ 2000 –≥–æ–¥—É –Ω–∞—á–∞–ª–∞—Å—å –Ω–∞—à–∞ –∏—Å—Ç–æ—Ä–∏—è ‚Äî —Å –æ–¥–Ω–æ–≥–æ –º–∞–ª–µ–Ω—å–∫–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞. –ê —Å–µ–π—á–∞—Å —É –Ω–∞—Å 13 —à–∫–æ–ª –≤ –ò—Ä–∫—É—Ç—Å–∫–µ –∏ –ê–Ω–≥–∞—Ä—Å–∫–µ!"
    },
    {
        "question": "–í–æ–ø—Ä–æ—Å ‚Ññ2\n–í –∫–∞–∫–∏—Ö –≥–æ—Ä–æ–¥–∞—Ö –º—ã –ù–ï –ø—Ä–æ–≤–æ–¥–∏–ª–∏ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–π –≤ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫?",
        "options": [
            "–î—É–±–∞–π, –ú–∞–Ω–∏–ª–∞, –ì–æ–Ω–∫–æ–Ω–≥",
            "–°–µ—É–ª, –ê–±—É-–î–∞–±–∏, –®—ç–Ω—å—è–Ω", 
            "–•–∞–Ω–æ–π, –ë—Ä–∞–∑–∏–ª–∏–∞, –î–∂–∞–∫–∞—Ä—Ç–∞"
        ],
        "correct_id": 2,
        "explanation": "–•–∞–Ω–æ–π, –ë—Ä–∞–∑–∏–ª–∏–∞ –∏ –î–∂–∞–∫–∞—Ä—Ç–∞ ‚Äî –≤ —ç—Ç–∏—Ö –≥–æ—Ä–æ–¥–∞—Ö –Ω–∞–º —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ –≤ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫. –ê –ø–æ–∫–∞ –∫–∞–∂–¥–æ–µ –ª–µ—Ç–æ (–∏ –¥–∞–∂–µ –∑–∏–º—É) –Ω–∞—à–∏ —Å—Ç—É–¥–µ–Ω—Ç—ã –∏–º–µ—é—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—É—Ç–µ—à–µ—Å—Ç–≤–æ–≤–∞—Ç—å –∏ –ø—Ä–∞–∫—Ç–∏–∫–æ–≤–∞—Ç—å —è–∑—ã–∫ –≤ –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–∞–Ω–∞—Ö –±–ª–∞–≥–æ–¥–∞—Ä—è –ø—Ä–æ–µ–∫—Ç—É ¬´Easy Travel¬ª."
    },
    {
        "question": "–í–æ–ø—Ä–æ—Å ‚Ññ3\n–ö–∞–∫–∏–µ –∏–∑ —ç—Ç–∏—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ –≤ Easy School?",
        "options": [
            "–î–µ–Ω—å –°–≤—è—Ç–æ–≥–æ –ü–∞—Ç—Ä–∏–∫–∞, –•—ç–ª–ª–æ—É–∏–Ω, Christmas Party",
            "–Ø–±–ª–æ—á–Ω—ã–π —Å–ø–∞—Å, –î–µ–Ω—å –æ—Ç–∫–∞–∑–∞ –æ—Ç –¥–∏–µ—Ç, –î–µ–Ω—å –∞—Ä–±—É–∑–∞",
            "–î–µ–Ω—å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞, –ü—Ä–∞–∑–¥–Ω–∏–∫ –∫–∏—Ç–∞–π—Å–∫–æ–π –∑–∞–≤–∞—Ä–∫–∏, –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π –¥–µ–Ω—å –∫–æ—Ä–µ–π—Å–∫–∏—Ö –ø–µ–ª—å–º–µ—à–µ–∫"
        ],
        "correct_id": 0,
        "explanation": "–ó–∞ 25 –ª–µ—Ç –º—ã –ø—Ä–æ–≤–µ–ª–∏ –º–Ω–æ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π: –æ—Ç –•—ç–ª–ª–æ—É–∏–Ω–∞ –¥–æ –†–æ–∂–¥–µ—Å—Ç–≤–µ–Ω—Å–∫–∏—Ö –≤–µ—á–µ—Ä–∏–Ω–æ–∫, –æ—Ç —Å–µ–º–∏–Ω–∞—Ä–æ–≤ –ø–æ —Ç–∞–π–º-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç—É –¥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –ø—Ä–æ–∫–∞—á–∫–∏ soft-skills —É –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤, –æ—Ç –∫–∏–Ω–æ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –¥–æ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –≤–µ—á–µ—Ä–∏–Ω–æ–∫. –ê –≤–ø–µ—Ä–µ–¥–∏ ‚Äî –µ—â—ë –±–æ–ª—å—à–µ!"
    },
    {
        "question": "–í–æ–ø—Ä–æ—Å ‚Ññ4\n–ö–∞–∫–æ–π –∫—É—Ä—Å –µ—Å—Ç—å –≤ Easy School?",
        "options": [
            "–¢—É—Ä–µ—Ü–∫–∏–π —è–∑—ã–∫",
            "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–º—É —ç–∫–∑–∞–º–µ–Ω—É –ø–æ –º–æ–Ω–≥–æ–ª—å—Å–∫–æ–º—É",
            "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ IELTS"
        ],
        "correct_id": 2,
        "explanation": "–í–º–µ—Å—Ç–µ —Å Easy School –º–æ–∂–Ω–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ —Å–¥–∞—á–µ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–≥–æ —ç–∫–∑–∞–º–µ–Ω–∞ –ø–æ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º—É —è–∑—ã–∫—É, –∞ –≤–æ—Ç —Ç—É—Ä–µ—Ü–∫–æ–º—É –∏ –º–æ–Ω–≥–æ–ª—å—Å–∫–æ–º—É –ø–æ–∫–∞ –Ω–µ –æ–±—É—á–∞–µ–º."
    },
    {
        "question": "–í–æ–ø—Ä–æ—Å ‚Ññ5\n–ö–∞–∫–æ–≥–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è –º—ã –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–µ–º—Å—è?",
        "options": [
            "Edutainment: –æ–±—É—á–µ–Ω–∏–µ + —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–µ",
            "–§—ç–Ω—à—É–π: –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–µ–±–µ–ª–∏",
            "No sitting down: —Å—Ç–æ—è –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –ª—É—á—à–µ"
        ],
        "correct_id": 0,
        "explanation": "–û–±—É—á–µ–Ω–∏–µ + —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–µ = —É—á—ë–±–∞ –±–µ–∑ –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏, —Å—Ç–µ—Å–Ω–µ–Ω–∏—è, —Ä—É—Ç–∏–Ω—ã –∏ —Å–∫—É–∫–∏. –≠—Ç–æ—Ç –ø—Ä–∏–Ω—Ü–∏–ø —É–∂–µ –¥–æ–∫–∞–∑–∞–ª —Å–≤–æ—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏–≤–Ω–æ—Å—Ç—å."
    }
]

FINAL_MESSAGES = [
    "–í —ç—Ç–∏—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö —Ç–æ–ª—å–∫–æ –º–∞–ª–µ–Ω—å–∫–∞—è —á–∞—Å—Ç—å –Ω–∞—à–µ–π –∏—Å—Ç–æ—Ä–∏–∏, –Ω–æ –Ω–∞–º —Ç–∞–∫ –ø—Ä–∏—è—Ç–Ω–æ, —á—Ç–æ —Å–µ–≥–æ–¥–Ω—è ‚Äî —Ç—ã –µ—ë —á–∞—Å—Ç—å üíñ ! –ì–æ—Ä–¥–∏–º—Å—è –∏ –≤–æ—Å—Ö–∏—â–∞–µ–º—Å—è —Ç–µ–º, —á—Ç–æ —Ç—ã –Ω–µ –ø–µ—Ä–µ—Å—Ç–∞—ë—à—å —É—á–∏—Ç—å—Å—è –∏ –≤–∫–ª–∞–¥—ã–≤–∞—Ç—å—Å—è –≤ —Å–≤–æ—ë —Ä–∞–∑–≤–∏—Ç–∏–µ. –õ–æ–≤–∏ –æ–±–µ—â–∞–Ω–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏ üëá",
    "1) –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ –î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è Easy School\n6 –¥–µ–∫–∞–±—Ä—è –ø—Ä–∞–∑–¥–Ω—É–µ–º –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –∏ –ø—Ä–∏–≥–ª–∞—à–∞–µ–º —Ç–µ–±—è –Ω–∞ –Ω–µ–≥–æ!\n‚ú®14:00, –î–æ–º –ú–æ–ª–æ–¥–µ–∂–∏ (—É–ª. –î–µ–∫–∞–±—Ä—å—Å–∫–∏—Ö –°–æ–±—ã—Ç–∏–π, 102/1).\n–ú–æ–∂–Ω–æ –≤–∑—è—Ç—å +1, –Ω–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –ø–æ —Å—Å—ã–ª–∫–µ, –µ—Å–ª–∏ –±—É–¥–µ—Ç–µ.",
    "2) –í—Ç–æ—Ä–æ–π –ø–æ–¥–∞—Ä–æ–∫ ‚Äî —É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–æ–≤ —Ç–≤–æ–µ–π —à–∫–æ–ª—ã!\n–ó–∞–≥–ª—è–¥—ã–≤–∞–π –∫ –Ω–∏–º, –≥–æ–≤–æ—Ä–∏ –∫–æ–¥–æ–≤–æ–µ ¬´–Ø –∑–∞ –ø–æ–¥–∞—Ä–∫–æ–º –∑–∞ Easy-–∫–≤–∏–∑¬ª, –∏ –æ–Ω–∏ –≤—Ä—É—á–∞—Ç —Ç–µ–±–µ –∫–æ–µ-—á—Ç–æ –Ω–µ–±–æ–ª—å—à–æ–µ, –Ω–æ –ø—Ä–∏—è—Ç–Ω–æ–µ.\n\n–ò —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –æ—Ç –Ω–∞—Å ‚Äî –±—É–¥–µ–º —Ä–∞–¥—ã –≤–∏–¥–µ—Ç—å—Å—è –Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ä–∞—Ö –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ —á–∞—â–µ üíú\nhttps://t.me/easyschoolyear1"
]

bot = telebot.TeleBot(TOKEN)

# –°–ª–æ–≤–∞—Ä–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
user_progress = {}  # chat_id -> —Ç–µ–∫—É—â–∏–π_–≤–æ–ø—Ä–æ—Å
poll_to_chat = {}   # poll_id -> chat_id

@bot.message_handler(commands=['start'])
def start(message):
    chat_id = message.chat.id
    user_progress[chat_id] = 0
    
    bot.send_message(
        chat_id,
        "–ü—Ä–∏–≤–µ—Ç! –í —ç—Ç–æ–º –≥–æ–¥—É Easy School –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è 25 –ª–µ—Ç ‚Äî –∑–∞ —ç—Ç–æ –≤—Ä–µ–º—è —É –Ω–∞—Å –ø—Ä–æ–∏–∑–æ—à–ª–æ —Ç–∞–∫ –º–Ω–æ–≥–æ –≤—Å–µ–≥–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ!\n\n"
        "–ê –¥–∞–≤–∞–π –æ–∑–Ω–∞–∫–æ–º–∏–º—Å—è –ø–æ–±–ª–∏–∂–µ? –í—Å—ë –ø—Ä–æ—Å—Ç–æ ‚Äî —Å —Ç–µ–±—è –æ—Ç–≤–µ—Ç—ã –Ω–∞ —ç—Ç–æ—Ç –º–∞–ª–µ–Ω—å–∫–∏–π –∫–≤–∏–∑, –∞ —Å –Ω–∞—Å ‚Äî –ø—Ä–∏—è—Ç–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫ –∑–∞ —ç—Ç–æ.\n\n"
        "–ü–æ–µ—Ö–∞–ª–∏?"
    )
    send_question(chat_id)

def send_question(chat_id):
    if chat_id not in user_progress:
        return
        
    index = user_progress[chat_id]
    if index >= len(QUESTIONS):
        return
        
    q = QUESTIONS[index]
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–ø—Ä–æ—Å –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–≤—è–∑—å poll_id -> chat_id
    try:
        sent_poll = bot.send_poll(
            chat_id,
            q["question"],
            q["options"],
            type="quiz",
            correct_option_id=q["correct_id"],
            is_anonymous=False
        )
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–≤—è–∑—å –º–µ–∂–¥—É ID –æ–ø—Ä–æ—Å–∞ –∏ —á–∞—Ç–æ–º
        poll_to_chat[sent_poll.poll.id] = chat_id
        print(f"–û—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤–æ–ø—Ä–æ—Å {index+1} –≤ —á–∞—Ç {chat_id}, poll_id: {sent_poll.poll.id}")
        
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ–ø—Ä–æ—Å–∞: {e}")

@bot.poll_answer_handler()
def handle_poll_answer(poll_answer):
    try:
        poll_id = poll_answer.poll_id
        print(f"–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –Ω–∞ –æ–ø—Ä–æ—Å {poll_id}")
        
        # –ù–∞—Ö–æ–¥–∏–º —á–∞—Ç –ø–æ ID –æ–ø—Ä–æ—Å–∞
        chat_id = poll_to_chat.get(poll_id)
        if chat_id is None:
            print(f"–ù–µ –Ω–∞–π–¥–µ–Ω —á–∞—Ç –¥–ª—è –æ–ø—Ä–æ—Å–∞ {poll_id}")
            print(f"–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–≤—è–∑–∏: {list(poll_to_chat.keys())}")
            return
            
        print(f"–ù–∞–π–¥–µ–Ω —á–∞—Ç {chat_id} –¥–ª—è –æ–ø—Ä–æ—Å–∞ {poll_id}")
        
        # –£–¥–∞–ª—è–µ–º —Å–≤—è–∑—å, —á—Ç–æ–±—ã –Ω–µ –∑–∞—Å–æ—Ä—è—Ç—å –ø–∞–º—è—Ç—å
        if poll_id in poll_to_chat:
            del poll_to_chat[poll_id]
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∫–≤–∏–∑–∞
        if chat_id not in user_progress:
            print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {chat_id} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ")
            return
            
        current_index = user_progress[chat_id]
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
        explanation = QUESTIONS[current_index]["explanation"]
        bot.send_message(chat_id, explanation)
        print(f"–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞ {current_index+1}")
        
        # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É –∏–ª–∏ –∑–∞–≤–µ—Ä—à–∞–µ–º
        next_index = current_index + 1
        if next_index < len(QUESTIONS):
            user_progress[chat_id] = next_index
            time.sleep(2)
            send_question(chat_id)
        else:
            # –ó–∞–≤–µ—Ä—à–∞–µ–º –∫–≤–∏–∑
            print(f"–ó–∞–≤–µ—Ä—à–∞–µ–º –∫–≤–∏–∑ –¥–ª—è —á–∞—Ç–∞ {chat_id}")
            for msg in FINAL_MESSAGES:
                time.sleep(2)
                bot.send_message(chat_id, msg)
            # –£–¥–∞–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if chat_id in user_progress:
                del user_progress[chat_id]
            print(f"–ö–≤–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω –¥–ª—è —á–∞—Ç–∞ {chat_id}")
                
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –≤ handle_poll_answer: {e}")

if __name__ == "__main__":
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –Ω–∞ Railway...")
    bot.infinity_polling()